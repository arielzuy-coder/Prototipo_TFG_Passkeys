# üöÄ INSTRUCCIONES DE DEPLOY EN RENDER.COM

## ‚úÖ Archivos Preparados

Ya prepar√© tu proyecto con todo lo necesario:

1. ‚úÖ `render.yaml` - Configuraci√≥n de Render
2. ‚úÖ `backend/init_db.py` - Script de inicializaci√≥n de base de datos
3. ‚úÖ CORS actualizado en `backend/app.py` para funcionar con Render
4. ‚úÖ `.gitignore` configurado correctamente

---

## üìù PASO 1: Subir a GitHub

### 1.1. Abrir terminal en la carpeta del proyecto

**Windows:**
- Abre la carpeta `Prototipo_TFG` en el Explorador
- Click derecho en un espacio vac√≠o
- Selecciona "Abrir en Terminal" o "Git Bash Here"

**Linux/Mac:**
```bash
cd /ruta/a/Prototipo_TFG
```

### 1.2. Inicializar Git

```bash
git init
```

### 1.3. Agregar todos los archivos

```bash
git add .
```

### 1.4. Hacer commit

```bash
git commit -m "Preparado para deploy en Render"
```

### 1.5. Crear repositorio en GitHub

1. Ve a: https://github.com/new
2. Nombre: `prototipo-tfg-auth` (o el que prefieras)
3. Descripci√≥n: "Sistema de autenticaci√≥n passwordless con WebAuthn y Zero Trust"
4. Elige **P√∫blico** o **Privado** (tu preferencia)
5. **NO marques** "Initialize this repository with a README"
6. Click en **"Create repository"**

### 1.6. Conectar y subir c√≥digo

GitHub te mostrar√° comandos. Usa estos:

```bash
# Conectar con tu repositorio (usa TU URL que aparece en GitHub)
git remote add origin https://github.com/TU-USUARIO/prototipo-tfg-auth.git

# Cambiar branch a main
git branch -M main

# Subir c√≥digo
git push -u origin main
```

**Si pide autenticaci√≥n:**
- Usuario: Tu usuario de GitHub
- Contrase√±a: Usa un **Personal Access Token** (no tu password normal)
  - Crear token: https://github.com/settings/tokens
  - Permisos: Solo marca "repo"

---

## üåê PASO 2: Crear Cuenta en Render

1. Ve a: https://render.com
2. Click en **"Get Started for Free"**
3. Elige **"Sign in with GitHub"** (m√°s f√°cil)
4. Autoriza a Render para acceder a tu GitHub
5. Listo, ya tienes cuenta

---

## üöÄ PASO 3: Deploy con Blueprint

### 3.1. Crear Blueprint

1. En el Dashboard de Render, click en **"New +"** (arriba a la derecha)
2. Selecciona **"Blueprint"**
3. Ver√°s tus repositorios de GitHub
4. Click en **"Connect"** al lado de `prototipo-tfg-auth`
   - Si no aparece, click en "Configure account" y da permisos

### 3.2. Configurar Blueprint

1. Render detectar√° autom√°ticamente tu `render.yaml`
2. Ver√°s la configuraci√≥n:
   - ‚úÖ auth-backend (Web Service)
   - ‚úÖ auth-frontend (Web Service)
   - ‚úÖ auth-postgres (Database)
3. Click en **"Apply"**

### 3.3. Esperar el deploy

- Render comenzar√° a construir y desplegar todo
- Ver√°s 3 servicios en tu Dashboard:
  - üü° auth-backend (Building...)
  - üü° auth-frontend (Building...)
  - üü¢ auth-postgres (Live)
- El primer deploy toma **5-10 minutos**
- Puedes ver los logs en tiempo real haciendo click en cada servicio

### 3.4. URLs generadas

Una vez que termine (todos en üü¢ Live), tendr√°s:

- **Backend:** `https://auth-backend.onrender.com`
- **Frontend:** `https://auth-frontend.onrender.com`

**IMPORTANTE:** Anota estas URLs, las necesitar√°s en el siguiente paso.

---

## ‚öôÔ∏è PASO 4: Configurar Variables de Entorno

### 4.1. Configurar Backend

1. En el Dashboard, click en **"auth-backend"**
2. En el men√∫ izquierdo, click en **"Environment"**
3. Busca estas variables y **actual√≠zalas**:

**Variables a cambiar:**

```
RP_ID
Valor actual: changeme-backend-url.onrender.com
Nuevo valor: auth-backend.onrender.com
(Usa la URL real de tu backend, sin https://)

ORIGIN
Valor actual: https://changeme-frontend-url.onrender.com
Nuevo valor: https://auth-frontend.onrender.com
(Usa la URL completa de tu frontend)
```

4. Click en **"Save Changes"**
5. Render redesplegar√° autom√°ticamente el backend (~2 minutos)

### 4.2. Configurar Frontend

1. En el Dashboard, click en **"auth-frontend"**
2. En el men√∫ izquierdo, click en **"Environment"**
3. Verifica/actualiza:

```
REACT_APP_API_URL
Valor debe ser: https://auth-backend.onrender.com
(La URL completa de tu backend)
```

4. Si necesitas cambiarla, click en **"Save Changes"**
5. Render redesplegar√° el frontend (~2 minutos)

---

## ‚úÖ PASO 5: Verificar que Funciona

### 5.1. Abrir la aplicaci√≥n

1. En el Dashboard de Render
2. Click en **"auth-frontend"**
3. Arriba ver√°s la URL: `https://auth-frontend.onrender.com`
4. Click en la URL para abrirla en tu navegador

### 5.2. Primera carga

‚ö†Ô∏è **IMPORTANTE:** La primera vez puede tardar ~30 segundos en cargar
- Esto es normal en el plan gratuito
- Los servicios se "duermen" tras 15 min sin uso
- Una vez que carga, funciona normal

### 5.3. Probar Registro

1. Deber√≠as ver la p√°gina de login
2. Navega a la p√°gina de registro:
   - En la URL agrega `/enroll`
   - Ejemplo: `https://auth-frontend.onrender.com/enroll`
3. Ingresa un email de prueba: `test@ejemplo.com`
4. Click en **"Registrar Passkey"**
5. Tu navegador pedir√° usar:
   - Huella digital üëÜ
   - Face ID ü§≥
   - PIN del dispositivo üî¢
6. Acepta y autoriza

### 5.4. Probar Login

1. Ve a la p√°gina de login: `https://auth-frontend.onrender.com/login`
2. Ingresa el mismo email: `test@ejemplo.com`
3. Click en **"Iniciar Sesi√≥n"**
4. Autoriza con tu dispositivo biom√©trico
5. Deber√≠as entrar al **Dashboard** ‚úÖ

### 5.5. Verificar Dashboard

Si ves el Dashboard con:
- ‚úÖ Tus estad√≠sticas
- ‚úÖ M√©tricas de acceso
- ‚úÖ Lista de Passkeys
- ‚úÖ Panel de administraci√≥n accesible

**¬°DEPLOY EXITOSO! üéâ**

---

## üêõ Soluci√≥n de Problemas Comunes

### Problema 1: "502 Bad Gateway" o "Service Unavailable"

**Causa:** El servicio se est√° iniciando (despertando del modo sleep)

**Soluci√≥n:**
- Espera 30-60 segundos
- Recarga la p√°gina
- Esto solo pasa despu√©s de 15 min sin uso

### Problema 2: Error "Invalid origin" o "CORS error"

**Causa:** Las variables `ORIGIN` o `RP_ID` est√°n mal configuradas

**Soluci√≥n:**
1. Ve a **auth-backend** ‚Üí **Environment**
2. Verifica que:
   - `RP_ID` = `auth-backend.onrender.com` (SIN https://)
   - `ORIGIN` = `https://auth-frontend.onrender.com` (CON https://)
3. Si est√°n mal, corr√≠gelas y guarda
4. Espera que redesplegue (~2 min)

### Problema 3: WebAuthn no funciona / No se registra Passkey

**Causa:** `RP_ID` no coincide con el dominio del backend

**Soluci√≥n:**
1. Ve a **auth-backend** ‚Üí **Environment**
2. Verifica `RP_ID`
3. Debe ser exactamente: `auth-backend.onrender.com`
4. NO debe tener:
   - ‚ùå `https://`
   - ‚ùå Espacios
   - ‚ùå Barra final `/`
5. Formato correcto: `auth-backend.onrender.com` ‚úÖ

### Problema 4: Frontend no carga o muestra p√°gina en blanco

**Causa:** Error en el build de React o variables mal configuradas

**Soluci√≥n:**
1. Ve a **auth-frontend** ‚Üí **Logs**
2. Busca errores (l√≠neas en rojo)
3. Si dice "REACT_APP_API_URL is undefined":
   - Ve a **Environment**
   - Agrega: `REACT_APP_API_URL` = `https://auth-backend.onrender.com`
   - Guarda y espera redespliegue
4. Si persiste:
   - Click en **"Manual Deploy"** ‚Üí **"Clear build cache & deploy"**

### Problema 5: Base de datos vac√≠a / No hay pol√≠ticas

**Causa:** El script `init_db.py` no se ejecut√≥ correctamente

**Soluci√≥n:**
1. Ve a **auth-backend** ‚Üí **Logs**
2. Busca l√≠neas que digan:
   - "Creando tablas de base de datos..."
   - "‚úÖ Tablas creadas exitosamente"
3. Si no aparecen o hay errores:
   - Click en **"Manual Deploy"** ‚Üí **"Deploy latest commit"**
4. Los logs deber√≠an mostrar la inicializaci√≥n correcta

### Problema 6: "Build failed"

**Causa:** Error en el c√≥digo o dependencias

**Soluci√≥n:**
1. Ve al servicio que fall√≥
2. Click en **"Logs"**
3. Lee el error (√∫ltima l√≠nea en rojo)
4. Errores comunes:
   - Falta alg√∫n archivo
   - Error de sintaxis
   - Dependencia faltante
5. Corr√≠gelo en tu c√≥digo local
6. Sube los cambios:
   ```bash
   git add .
   git commit -m "Corregir error de build"
   git push
   ```
7. Render redesplegar√° autom√°ticamente

---

## üìä Monitoreo y Mantenimiento

### Ver Logs en Tiempo Real

1. Ve a cualquier servicio
2. Click en **"Logs"** en el men√∫ izquierdo
3. Ver√°s:
   - Requests entrantes
   - Errores
   - Logs de la aplicaci√≥n

### Ver M√©tricas

1. En cada servicio
2. Ver√°s gr√°ficos de:
   - CPU usage
   - Memory usage
   - Request rate

### Hacer Actualizaciones

Si haces cambios en tu c√≥digo:

```bash
cd Prototipo_TFG

# Hacer cambios...

git add .
git commit -m "Descripci√≥n de cambios"
git push
```

Render detectar√° el push autom√°ticamente y redesplegar√° tu app.

---

## üéì Tips para la Presentaci√≥n de TFG

### Antes de Presentar (10 minutos antes)

1. **"Despertar" la aplicaci√≥n:**
   - Abre `https://auth-frontend.onrender.com` en tu navegador
   - Haz un login de prueba
   - Navega por el dashboard
   - Esto evita el delay de 30 seg al iniciar

2. **Verificar que todo funciona:**
   - ‚úÖ Login con Passkey
   - ‚úÖ Dashboard carga
   - ‚úÖ Admin panel accesible
   - ‚úÖ M√©tricas se muestran

3. **Tener datos de ejemplo:**
   - Crea 2-3 usuarios de prueba
   - Registra Passkeys en diferentes dispositivos
   - Genera historial de accesos

### Durante la Presentaci√≥n

**Puntos a mencionar:**

- "Aplicaci√≥n desplegada en **Render.com**, una plataforma cloud moderna"
- "**SSL/TLS autom√°tico** con certificados de Let's Encrypt"
- "Base de datos **PostgreSQL** en la nube con persistencia de datos"
- "**WebAuthn/FIDO2** funcionando en producci√≥n real"
- "Arquitectura de **microservicios** con backend (Python/FastAPI) y frontend (React)"
- "Accesible desde **cualquier dispositivo** con internet"

**Demostraci√≥n sugerida:**

1. Mostrar p√°gina de registro
2. Registrar nueva Passkey en vivo
3. Hacer login con biometr√≠a
4. Mostrar dashboard con m√©tricas
5. Demostrar evaluaci√≥n de riesgo
6. Mostrar admin panel con pol√≠ticas

### Plan B

Graba un video de la demo por si:
- Falla internet en la presentaci√≥n
- Render tiene problemas (raro pero posible)
- Tu dispositivo no tiene biometr√≠a disponible

---

## üí∞ Costos y Planes

### Plan Actual (Gratuito)

‚úÖ Incluye:
- 750 horas/mes de runtime
- SSL autom√°tico
- Base de datos PostgreSQL (1GB)
- Deploy autom√°tico desde GitHub

‚ö†Ô∏è Limitaciones:
- Servicios se duermen tras 15 min sin uso
- BD se borra tras 90 d√≠as de inactividad
- Recursos limitados (512MB RAM por servicio)

### Si Necesitas M√°s (Opcional)

**Starter Plan ($7/mes por servicio):**
- ‚úÖ No se duerme nunca
- ‚úÖ 2GB RAM
- ‚úÖ Mejor rendimiento

**PostgreSQL Plan ($7/mes):**
- ‚úÖ 50GB almacenamiento
- ‚úÖ No borra datos nunca
- ‚úÖ Backups autom√°ticos

**Para TFG:** El plan gratuito es m√°s que suficiente

---

## üîó URLs de Referencia

Guarda estas URLs:

**Tu Aplicaci√≥n:**
- Frontend: https://auth-frontend.onrender.com
- Backend API: https://auth-backend.onrender.com
- API Docs: https://auth-backend.onrender.com/docs

**Dashboards:**
- Render Dashboard: https://dashboard.render.com
- GitHub Repo: https://github.com/TU-USUARIO/prototipo-tfg-auth

---

## ‚úÖ Checklist Final

Antes de dar por terminado el deploy:

- [ ] Frontend carga en `https://auth-frontend.onrender.com`
- [ ] Backend responde en `https://auth-backend.onrender.com/health`
- [ ] API docs accesible en `https://auth-backend.onrender.com/docs`
- [ ] Puedo registrar una Passkey en `/enroll`
- [ ] Puedo hacer login con la Passkey
- [ ] Dashboard muestra datos
- [ ] Admin panel es accesible
- [ ] SSL funciona (candado verde üîí en navegador)
- [ ] Variables `RP_ID` y `ORIGIN` configuradas correctamente

---

## üéâ ¬°√âxito!

Tu aplicaci√≥n ahora est√°:
- ‚úÖ Desplegada en la nube
- ‚úÖ Accesible p√∫blicamente
- ‚úÖ Con HTTPS funcionando
- ‚úÖ WebAuthn operativo
- ‚úÖ Sin costo
- ‚úÖ Lista para tu TFG

**¬°Mucha suerte con tu presentaci√≥n! üéì**

---

## üìû Soporte

Si tienes problemas:

1. Revisa la secci√≥n "Soluci√≥n de Problemas Comunes" arriba
2. Verifica los logs en Render Dashboard
3. Consulta la documentaci√≥n: https://render.com/docs
4. Render Community: https://community.render.com

---

**Creado:** Octubre 2025  
**Para:** TFG Universidad Siglo 21  
**Versi√≥n:** 1.0
